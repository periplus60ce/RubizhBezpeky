<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Виклик Цифрового Захисту</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="welcome">
    <h1 id="welcome-title">Ласкаво просимо до Виклику Цифрового Захисту</h1>
    <p>Ваш підрозділ ПСО прибув до зони бойових дій. <span id="welcome-description-1">Кожен сценарій містить кіберзагрози, які потрібно нейтралізувати. Обирай правильні заходи. Замало — і ти вразливий. Забагато — втрачаєш ефективність.</span></p>
    <p><span id="welcome-description-2">Кожна правильна дія дає бали. Кожна зайва — мінус 5%. Обирай мудро!</span></p>
    <button class="submit-btn" onclick="startGame()" id="start-button">Почати Бойове Завдання</button>
</div>

<div class="scenario" id="scenarioContainer"></div>
<div class="result" id="resultContainer"></div>
<div id="actionResults" style="display:none; margin: 20px auto; padding: 10px; border: 2px solid #00f6ff; background: rgba(0,0,0,0.8); border-radius: 8px; position: relative; max-width: 700px;">
  <button onclick='closeActionResults()' style='position: absolute; top: 5px; right: 10px; background: red; color: white; border: none; border-radius: 4px; cursor: pointer;'>X</button>
  <div id="actionDetails"></div>
</div>
<div id="threatSummaryBox" style="display:none; margin: 20px auto; padding: 10px; border: 2px solid #ff4d00; background: rgba(0,0,0,0.85); border-radius: 8px; position: relative; max-width: 700px;">
  <button onclick='closeThreatSummary()' style='position: absolute; top: 5px; right: 10px; background: red; color: white; border: none; border-radius: 4px; cursor: pointer;'>X</button>
  <div id="threatSummary"></div>
</div>
<div class="final-result" id="finalContainer"></div>

<script>
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.key === "F12" || 
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J" || e.key === "C")) ||
      (e.ctrlKey && e.key === "U")
    ) {
      e.preventDefault();
    }
  });
</script>
	
<script>
  let scenarioContainer, resultContainer, finalContainer, actionDetails;
  let currentScenario = 0;
  let totalScore = 0;

  const scenarios = [
	{
		text: "Привітний Вартовий: По прибуттю групу ПСО зустрічає балакучий місцевий господар, який пропонує допомогу з Wi-Fi. Роутер стоїть відкрито в коридорі. Господар здається надмірно зацікавленим і затримується під час налаштування. Через дорогу припаркована цивільна машина з тонованим лобовим склом і періодичними спалахами телефону.",
		correct: ["Використати польовий роутер", "Провести RF-сканування", "Вимкнути автопідключення", "Рандомізація MAC-адреси", "Розмістити роутер у захищеному внутрішньому приміщенні"],
		choices: ["Використати польовий роутер", "Провести RF-сканування", "Вимкнути автопідключення", "Рандомізація MAC-адреси", "Розмістити роутер у захищеному внутрішньому приміщенні", "Увімкнути Bluetooth", "Приєднатись до місцевого Discord", "Прийняти стандартну назву Wi-Fi", "Надати доступ до мережі обраним особам"],
		threat: "Існує ймовірність наявності шкідливої точки доступу або скомпрометованого маршрутизатора. Є ризик атак типу “людина посередині”, перехоплення пакетів або підміни DNS. Місцеві мешканці можуть співпрацювати з противником і використовувати Wi-Fi для збору метаданих або відстеження трафіку. Також існує загроза відстеження чи ідентифікації пристроїв за MAC-адресами.",
	},
	{
		text: "Погляди в Небо: Тарілка Starlink перезавантажується час від часу. Поруч стоїть кілька місцевих із телефонами. Керівник групи помічає, що в мережі нещодавно з’явилось теплове відео з атаками на подібні тарілки.",
		correct: ["Замаскувати термінал Starlink сіткою або камуфляжем", "Розмістити термінал всередині будівлі або на горищі", "Використовувати UPS (джерело безперебійного живлення)", "Провести RF-сканування на наявність завад або перешкод", "Обмежити LAN-доступ до Starlink за допомогою фаєрволу або правил MAC", "Маршрутизувати весь вихідний трафік через VPN на рівні роутера"],
		choices: ["Замаскувати термінал Starlink сіткою або камуфляжем", "Розмістити термінал всередині будівлі або на горищі", "Використовувати UPS (джерело безперебійного живлення)", "Провести RF-сканування на наявність завад або перешкод", "Обмежити LAN-доступ до Starlink за допомогою фаєрволу або правил MAC", "Маршрутизувати весь вихідний трафік через VPN на рівні роутера", "Скинути Starlink до заводських налаштувань", "Поставити охоронця біля тарілки", "Встановити сніфери пакетів на всі LAN-пристрої", "Активувати Bluetooth-тетеринг", "Вимкнути оновлення прошивки Starlink", "Запустити безперервне теплове сканування зсередини будівлі"],
		threat: "Фізичне втручання або саботаж терміналу Starlink. Радіочастотні перешкоди або глушіння, спрямовані на супутниковий канал. Теплова видимість може зробити антену мішенню для баражуючих боєприпасів або непрямого вогню. Місцеві, які фотографують обладнання, можуть передавати дані для наведення або проводити візуальну розвідку. Існує ризик кіберзламу у випадку неправильного налаштування маршрутизатора або доступу до Starlink через локальну мережу.",
	},
	{
		text: "Спільне Житло: Орендоване житло має спільну інфраструктуру з хазяїном, що живе на першому поверсі. Хазяїн жартує про «вашу історію переглядів». Через провулок помічають людину, яка регулярно знімає будівлю.",
		correct: ["Використання VPN на рівні маршрутизатора", "Відмова від використання спільної мережі", "Використання безпечного роутера або точки доступу", "Увімкнення рандомізації MAC-адрес", "Шифрування DNS трафіку через DoH/DoT", "Приховати внутрішній простір за допомогою щільних штор або теплового фільму", "Сканування Wi-Fi на предмет неавторизованих пристроїв", "Ізоляція пристроїв через VLAN або фільтрація при використанні власного роутера"],
		choices: ["Використання VPN на рівні маршрутизатора", "Відмова від використання спільної мережі", "Використання безпечного роутера або точки доступу", "Увімкнення рандомізації MAC-адрес", "Шифрування DNS трафіку через DoH/DoT", "Приховати внутрішній простір за допомогою щільних штор або теплового фільму", "Сканування Wi-Fi на предмет неавторизованих пристроїв", "Ізоляція пристроїв через VLAN або фільтрація при використанні власного роутера", "Зміна всієї проводки в будівлі", "Підкуп хазяїна, щоб він не ліз у мережу", "Встановити глушилки для сусідського Wi-Fi", "Скинути маршрутизатор хазяїна", "Переналаштувати камери спостереження сусідів", "Ротація до нового будинку кожні 24 години"],
		threat: "Спільна мережа = скомпрометований периметр — орендодавець має доступ до трафіку, MAC-адрес і часових міток. Відсутність сегментації мережі наражає пристрої команди на ризик прослуховування та впровадження шкідливого трафіку. Пасивне спостереження з іншого боку провулка може сприяти наведенням або ідентифікації персоналу. Цивільний адміністратор має повний доступ до маршрутизатора; можливі підміна DNS, журналювання трафіку або вставлення бекдорів. Витік візуальної інформації через вікна (світіння екранів, силуети, відбиття).",
	},
	{
		text: "Казино Рояль: У вільний час боєць ПСО відвідує місцевий гральний заклад і підключається до відкритої Wi-Fi мережі. Через кілька днів у мережі підрозділу виникають аномалії DNS. У Telegram з’являється відео з цим бійцем у барі.",
		correct: ["Використання окремих пристроїв для дозвілля або розвідки", "Ізоляція та аналіз скомпрометованого пристрою", "Заборона підключення до неавторизованих мереж", "Регулярна ротація MAC-адрес і ідентифікаторів пристроїв", "OSINT-перевірка на витік контенту", "Повне очищення або перепрошивка пристрою", "DNS-блокування через Pi-hole або інші засоби"],
		choices: ["Конфіскація та перевірка всіх місцевих Wi-Fi мереж", "Назавжди вимкнути Wi-Fi на всіх пристроях", "Цілодобовий захоплення трафіку в локальній мережі", "Покарання або ізоляція особи без коригувальних дій", "Встановлення шпигунського ПЗ на пристрій", "Використання окремих пристроїв для дозвілля або розвідки", "Ізоляція та аналіз скомпрометованого пристрою", "Заборона підключення до неавторизованих мереж", "Регулярна ротація MAC-адрес і ідентифікаторів пристроїв", "OSINT-перевірка на витік контенту", "Повне очищення або перепрошивка пристрою", "DNS-блокування через Pi-hole або інші засоби"],
		threat: "Використання публічної/відкритої Wi-Fi мережі наражає пристрій на атаки типу «людина посередині» (MITM), впровадження шкідливого ПЗ та перехоплення сесій. Пристрій може бути скомпрометовано та використовуватись як точка доступу або інструмент для ексфільтрації даних. Витік відеоматеріалів створює ризик для ОПБЕЗ: підтверджує присутність, розкриває моральний стан або настрій, надає матеріали для інформаційно-психологічних операцій. Метадані з пристрою (ім’я хоста, MAC-адреса, історія переглядів) могли бути збережені або використані. Поведінковий профайлінг або загроза шантажу, якщо компрометуючий контент потрапить до рук противника.",
	},
	{
		text: "Примарні Додатки: Місцевий продавець радить встановити популярний додаток для орієнтування в місті. Один із членів групи встановлює APK-файл вручну. Через кілька годин у мережі виявляють підозрілу активність. У додатку є накладання GPS і запити на доступ.",
		correct: ["Заборонити сторонні APK та дозволити лише офіційні джерела", "Використання офлайн-карт і навігаційних засобів", "Ізолювати або знищити скомпрометований пристрій", "Аналізувати APK у повітряно-ізольованому середовищі", "Блокувати підозрілі IP/домен через DNS", "Ротація ідентифікаторів пристрою і скидання паролів", "Журналювання і аудит усіх встановлених додатків"],
		choices: ["Заборонити всі мобільні додатки", "Глушити мобільний сигнал у зоні", "Встановити державне шпигунське ПЗ", "Очистити всі телефони підрозділу", "Фізично знищити магазин продавця", "Використовувати тільки паперові карти", "Заборонити сторонні APK та дозволити лише офіційні джерела", "Використання офлайн-карт і навігаційних засобів", "Ізолювати або знищити скомпрометований пристрій", "Аналізувати APK у повітряно-ізольованому середовищі", "Блокувати підозрілі IP/домен через DNS", "Ротація ідентифікаторів пристрою і скидання паролів", "Журналювання і аудит усіх встановлених додатків"],
		threat: "Завантажені поза офіційним магазином додатки (особливо APK з ненадійних джерел) можуть містити трояни, шпигунське ПЗ або функції маяків. Додаток може запитувати надмірні дозволи: доступ до мікрофона, GPS, камери, сховища. Вихідний трафік до невідомих серверів може свідчити про ексфільтрацію даних або управління та контроль (C2). Відстеження місцезнаходження може використовуватись для наведення або аналізу стилю життя. Популярність додатку серед місцевого населення може свідчити, що він використовується як нормалізований інструмент стеження.",
	},
	{
		text: "Метадані Масажу: Двоє бійців ПСО відвідують місцевий масажний салон. Через два дні на їхні військові телефони надходять фішингові SMS. Один з них фігурує на фоні відео, опублікованого персоналом салону в соцмережах.",
		correct: ["Заборонити відвідування неперевірених закладів під час виконання завдання", "Використання телефонів з одноразовими SIM-картами без зв'язку з особою", "Негайна ротація SIM-карт та IMEI пристроїв", "Видалення компрометованого контенту через офіційні запити або контрзаходи", "OSINT-перевірка на фото/відео в мережі та метадані", "Режим польоту + зберігання пристрою в екранованому контейнері поза базою", "Навчання персоналу ризикам прихованого спостереження"],
		choices: ["Конфіскація всіх особистих телефонів", "Занести до чорного списку всі салони масажу", "Перекинути SIGINT на моніторинг цивільних номерів", "Публічне покарання всього підрозділу", "Заборонити всі соцмережі на особистих пристроях", "Інсценування онлайн-розриву чи постів для дезінформації", "Заборонити відвідування неперевірених закладів під час виконання завдання", "Використання телефонів з одноразовими SIM-картами без зв'язку з особою", "Негайна ротація SIM-карт та IMEI пристроїв", "Видалення компрометованого контенту через офіційні запити або контрзаходи", "OSINT-перевірка на фото/відео в мережі та метадані", "Режим польоту + зберігання пристрою в екранованому контейнері поза базою", "Навчання персоналу ризикам прихованого спостереження"],
		threat: "Використання особистих або закріплених за підрозділом телефонів у незахищених цивільних просторах несе ризик витоку або реєстрації номерів. Метадані з журналів дзвінків, Wi-Fi-запитів або платіжних систем можуть бути передані співпрацівникам противника. Цільовий фішинг, ймовірно, спричинений витоком SIM-карти або збиранням контактів. Фото- та відеоматеріали створюють вразливості для ОПБ: можна визначити особу, моральний стан, місцезнаходження та час. Існує ризик поведінкового профілювання або використання компрометуючих матеріалів у ворожих наративах.",
	},
	{
		text: "Корчма: Один з бійців ПСО напивається в місцевому барі. Згодом з’являється дипфейкове відео з його антивладними заявами. Відомий колаборант, пов'язаний з каналами ворога, працює в тому ж барі.",
		correct: ["Заборонити несанкціоновану одиночну активність у незахищених зонах", "Призначити офіцера з публічної комунікації від підрозділу", "Навчити команду ризикам дипфейків", "Моніторити OSINT-джерела та подавати запити на видалення фейків", "Використовувати аксесуари проти розпізнавання обличчя поза базою", "Розробити і поширити контрнаратив у разі вірусного розголосу", "Запровадити протоколи «тверезого напарника» поза службою"],
		choices: ["Повна заборона пересування поза базою", "Постійні бодікамери для всіх бійців", "Негайне звільнення учасника без перевірки", "Психологічні операції проти персоналу бару", "Заміна бійця на аватар, згенерований ШІ", "Хірургічна зміна обличчя або протези для анонімності", "Заборонити несанкціоновану одиночну активність у незахищених зонах", "Призначити офіцера з публічної комунікації від підрозділу", "Навчити команду ризикам дипфейків", "Моніторити OSINT-джерела та подавати запити на видалення фейків", "Використовувати аксесуари проти розпізнавання обличчя поза базою", "Розробити і поширити контрнаратив у разі вірусного розголосу", "Запровадити протоколи «тверезого напарника» поза службою"],
		threat: "Соціальна інженерія та агентурна діяльність (HUMINT): місцеві оперативники можуть вивідати інформацію, змусивши персонал говорити відкрито, таємно записуючи розмови. Фото- та відеоспостереження: записи можуть бути змінені, дипфейкнуті або навмисно злиті для психологічних чи інформаційних атак. Порушення ОПБ через вживання алкоголю та відсутність дисципліни під час операцій. Технології розпізнавання облич і клонування голосу можуть бути використані для створення фальсифікованих дезінформаційних матеріалів. Підрив морального духу або довіри в підрозділі, якщо фейкове відео буде сприйняте як справжнє або почне поширюватися.",
	},
	{
		text: "Дипломатія Флешки: Цивільна особа пропонує групі USB-флешку з «локальними картами та радіочастотами». Один із бійців вставляє її в ноутбук. Пізніше виявляється активність бекдора.",
		correct: ["Ніколи не вставляти неперевірені USB у робочу/офіційну техніку", "**Якщо аналіз необхідний — лише в повітряно ізольованому середовищі", "Використовувати USB-блокатори для захисту та аналізу", "Відновлення пристрою перевіреним образом ОС", "Ізолювати або знищити пристрій, або перетворити його на пастку", "Використовувати EDR/антивіруси для моніторингу USB-подій", "Навчити команду соціальній інженерії через USB"],
		choices: ["Фізично знищити всі USB в регіоні", "Заборонити цифрові карти", "Обов’язкове повне сканування пристроїв щодня", "Допитати цивільного", "Назавжди вимкнути всі USB порти", "Кваліфікувати інцидент як HUMINT-компрометацію", "Ніколи не вставляти неперевірені USB у робочу/офіційну техніку", "**Якщо аналіз необхідний — лише в повітряно ізольованому середовищі", "Використовувати USB-блокатори для захисту та аналізу", "Відновлення пристрою перевіреним образом ОС", "Ізолювати або знищити пристрій, або перетворити його на пастку", "Використовувати EDR/антивіруси для моніторингу USB-подій", "Навчити команду соціальній інженерії через USB"],
		threat: "USB-носії з ненадійних джерел — класичний вектор кібернападу (наприклад, BadUSB, Rubber Ducky). Носій може містити виконувані файли, скрипти або шкідливе ПЗ на рівні прошивки. Підключення до оперативного пристрою створює ризик підвищення привілеїв, спостереження або ексфільтрації даних. Можливе подолання повітряного зазору, встановлення маячків або автоматизоване впровадження бекдорів, що може поставити під загрозу всю мережу підрозділу. Навіть файли, що виглядають легітимно (наприклад, PDF, DOCX), можуть містити вбудовані макроси або шкідливі експлойти.",
	},
	{
		text: "Орендодавець Все Логує: Під час вечері орендодавець натякає, що знає MAC-адреси, часові мітки та історію переглядів підрозділу. Під полицею в кімнаті виявлено приховану камеру GoPro.",
		correct: ["Використання незалежної, зашифрованої точки доступу або мобільного роутера", "Рандомізація MAC-адрес для всіх пристроїв", "DNS-шифрування через DoH або DoT", "Повний технічний огляд на наявність прослуховування", "Теплове/візуальне екранування приміщення", "VLAN та ізоляція трафіку між пристроями", "Аудит логів і аналіз трафіку після компрометації"],
		choices: ["Фізичне знищення роутера орендодавця", "Подати кримінальну заяву під час завдання", "Встановити прослушку у квартирі орендодавця", "Змінити житло негайно", "Виділити чергового спостерігача 24/7", "Заборонити внутрішній обмін даними між пристроями", "Використання незалежної, зашифрованої точки доступу або мобільного роутера", "Рандомізація MAC-адрес для всіх пристроїв", "DNS-шифрування через DoH або DoT", "Повний технічний огляд на наявність прослуховування", "Теплове/візуальне екранування приміщення", "VLAN та ізоляція трафіку між пристроями", "Аудит логів і аналіз трафіку після компрометації"],
		threat: "Мережеве спостереження: орендодавець має доступ до спільного маршрутизатора та веде журнал метаданих — DNS-запити, цифрові відбитки пристроїв, шаблони використання. MAC-адреси та часові мітки дозволяють поведінкове профілювання, деанонімізацію та довготривале відстеження. Витік DNS може розкрити оперативні інтереси або плани. Прихована камера спостереження створює фізичну загрозу типу SIGINT/OSINT — аудіо/відео збір. Кібер- та візуальне стеження свідчать про можливу випадкову активність або координацію з противником.",
	},
	{
		text: "Місцеві Хакери на Замовлення: Через дорогу від орендованого будинку знаходиться інтернет кафе, де молоді хакери хизуються атаками на польські сервери. Їхній Wi-Fi видно з будинку. Пасивне сканування виявляє використання Wireshark у підмережі.",
		correct: ["Сегментація мережі та обмеження вихідного трафіку", "Вимкнення служб виявлення — mDNS, SSDP, NetBIOS тощо", "Рандомізація MAC, прихований SSID, статичні IP", "Регулярні RF-сканування на наявність підозрілих точок доступу", "Обмеження радіусу дії Wi-Fi до приміщення", "Пасивне спостереження за інфраструктурою кафе без втручання", "Навчання персоналу роботі в умовах загроз поруч"],
		choices: ["Запустити кібератаку у відповідь", "Знищити роутер або будівлю кафе", "Глушити їхній сигнал постійно", "Негайно залишити будинок", "Вважати всіх цивільних агентами противника", "Перейти повністю на офлайн-засоби", "Рандомізація MAC, прихований SSID, статичні IP", "Регулярні RF-сканування на наявність підозрілих точок доступу", "Обмеження радіусу дії Wi-Fi до приміщення", "Пасивне спостереження за інфраструктурою кафе без втручання", "Навчання персоналу роботі в умовах загроз поруч"],
		threat: "Кібер вороги перебувають у фізичній близькості, ймовірно проводять пасивну та активну розвідку. Їхній сигнал Wi-Fi перекривається з районом присутності підрозділу ПСО, що підвищує ризик перехоплення радіочастот, підроблених SSID або атак через побічні канали. Інструменти моніторингу (наприклад, Wireshark) свідчать, що вони захоплюють трафік і, можливо, зондують сусідні мережі. Існує ймовірність співпраці з ворожими спецслужбами або надання C2 (керування і контроль) як послуги для сил противника. Навіть близькість до енергомережі або електромагнітні витоки можуть створити ризик для розвідки сигналів (SIGINT).",
	},
	];

  document.addEventListener("DOMContentLoaded", function () {
    scenarioContainer = document.getElementById("scenarioContainer");
    resultContainer = document.getElementById("resultContainer");
    finalContainer = document.getElementById("finalContainer");
    actionDetails = document.getElementById("actionDetails");
    threatSummary = document.getElementById("threatSummary");
  });
  
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function startGame() {
    shuffleArray(scenarios);
    currentScenario = 0;
    totalScore = 0;
    document.querySelector(".welcome").style.display = "none";
    showScenario();
  }

  function showScenario() {
    function shuffleArrayLocal(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    scenarioContainer.innerHTML = '';
    resultContainer.style.display = 'none';
    const s = JSON.parse(JSON.stringify(scenarios[currentScenario]));
    shuffleArrayLocal(s.choices);

    const scenarioText = document.createElement("h2");
    scenarioText.textContent = s.text;

    const btnGroup = document.createElement("div");
    btnGroup.className = "buttons";

    const choices = s.choices;
    choices.forEach((choice, index) => {
      const btn = document.createElement("button");
      btn.textContent = choice;
      btn.onclick = () => btn.classList.toggle("selected");
      btn.dataset.index = index;
      btnGroup.appendChild(btn);
    });

    const submitBtn = document.createElement("button");
    submitBtn.textContent = "Підтвердити";
    submitBtn.className = "submit-btn";
    submitBtn.onclick = function () { evaluateAnswer(s, choices); };

    const threatBtn = document.createElement("button");
    threatBtn.textContent = "ПІДСУМОК ЗАГРОЗ";
    threatBtn.className = "submit-btn";
    threatBtn.onclick = function () { showThreatSummary(s.threat); };
	
	scenarioContainer.appendChild(scenarioText);
    scenarioContainer.appendChild(btnGroup);
    scenarioContainer.appendChild(submitBtn);
    scenarioContainer.appendChild(threatBtn);
    scenarioContainer.style.display = "block";
  }

  function showThreatSummary(summaryText) {
    threatSummary.innerHTML = `<p>${summaryText}</p>`;
    document.getElementById("threatSummaryBox").style.display = "block";
  }

  function closeThreatSummary() {
    document.getElementById("threatSummaryBox").style.display = "none";
  }

  function evaluateAnswer(scenarioData, displayedChoices) {
    const selected = Array.from(scenarioContainer.querySelectorAll("button.selected"));
    const selectedText = selected.map(b => scenarioData.choices[b.dataset.index]);
    const correct = scenarioData.correct;

    let correctCount = selectedText.filter(txt => correct.includes(txt)).length;
    let excessCount = selectedText.filter(txt => !correct.includes(txt)).length;
    let missedCount = correct.filter(txt => !selectedText.includes(txt)).length;

    let score = Math.max(0, ((correctCount / correct.length) * 100) - (excessCount * 5));
    totalScore += score;

    scenarioContainer.style.display = "none";

    let actionSummary = `<ul>`;
    selectedText.forEach(choice => {
      if (correct.includes(choice)) {
        actionSummary += `<li style='color: lime;'>✅ ${choice} — Ефективно</li>`;
      } else {
        actionSummary += `<li style='color: orange;'>⚠️ ${choice} — Зайве або непотрібне</li>`;
      }
    });
    correct.forEach(item => {
      if (!selectedText.includes(item)) {
        actionSummary += `<li style='color: red;'>❌ ${item} — Пропущено критичний захід</li>`;
      }
    });
    actionSummary += `</ul>`;
    actionDetails.innerHTML = actionSummary;

    resultContainer.innerHTML = `<h3>Результат сценарію ${currentScenario + 1}</h3>
      <p class="score">Your Score: ${score.toFixed(1)}%</p>
      <p>Correct: ${correctCount} / ${correct.length}, Зайвих: ${excessCount}, Пропущено: ${missedCount}</p>
      <button class='submit-btn' onclick='viewActionResults()'>Переглянути дії</button>`;
    resultContainer.style.display = "block";

    currentScenario++;
    if (currentScenario < scenarios.length) {
      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Наступний сценарій";
      nextBtn.className = "submit-btn";
      nextBtn.onclick = showScenario;
      resultContainer.appendChild(nextBtn);
    } else {
      const finalBtn = document.createElement("button");
      finalBtn.textContent = "Показати підсумок";
      finalBtn.className = "submit-btn";
      finalBtn.onclick = showFinalResult;
      resultContainer.appendChild(finalBtn);
    }
  }

  function viewActionResults() {
    document.getElementById("actionResults").style.display = "block";
  }

  function closeActionResults() {
    document.getElementById("actionResults").style.display = "none";
  }

  function showFinalResult() {
    resultContainer.style.display = "none";
    finalContainer.style.display = "block";
    const avg = totalScore / scenarios.length;

    let msg = "", img = "";
    if (avg >= 90) {
      msg = "Ви надзвичайно захищені. Рівень — Цифровий Замок!";
      img = "digcastle.jpg";
    } else if (avg >= 80) {
      msg = "Ви у безпеці. Рівень — Цифрова Фортеця";
      img = "digfort.jpg";
    } else if (avg >= 70) {
      msg = "Безпека на межі. Рівень — Колючий дріт";
      img = "digbarb.img";
    } else {
      msg = "Ви вразливі. Необхідно вивчити DFP. Рівень — Легка мішень";
      img = "digduck.jpg";
    }

    finalContainer.innerHTML = `<h2>Підсумковий результат: ${avg.toFixed(1)}%</h2>
      <p>${msg}</p>
      <img src="${img}" alt="Result" class="result-img" />`;
  }
</script>
</body>
</html>
